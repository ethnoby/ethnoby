(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{567:function(e,t,r){"use strict";var n=r(568);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=n(r(636)),o=n(r(321)),l=n(r(557)),h=n(r(558)),d=r(716),f=r(622),y=r(762),v=r(763),_=r(764),m=function(){function e(t){var r=this;(0,l.default)(this,e),this.updateConfiguration(t),this.searchClient={clearCache:function(){return r.clearCache()},search:function(e){return r.searchTypesenseAndAdapt(e)},searchForFacetValues:function(e){return r.searchTypesenseForFacetValuesAndAdapt(e)}}}var t,r,n;return(0,h.default)(e,[{key:"searchTypesenseAndAdapt",value:(n=(0,o.default)(c.default.mark((function e(t){var r,n,o=this;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._adaptAndPerformTypesenseRequest(t);case 3:return r=e.sent,n=r.results.map((function(e,r){return o._validateTypesenseResult(e),new v.SearchResponseAdapter(e,t[r],o.configuration).adapt()})),e.abrupt("return",{results:n});case 8:throw e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return n.apply(this,arguments)})},{key:"searchTypesenseForFacetValuesAndAdapt",value:(r=(0,o.default)(c.default.mark((function e(t){var r,n,o=this;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._adaptAndPerformTypesenseRequest(t);case 3:return r=e.sent,n=r.results.map((function(e,r){return o._validateTypesenseResult(e),new _.FacetSearchResponseAdapter(e,t[r],o.configuration).adapt()})),e.abrupt("return",n);case 8:throw e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e){return r.apply(this,arguments)})},{key:"_adaptAndPerformTypesenseRequest",value:(t=(0,o.default)(c.default.mark((function e(t){var r,n;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new y.SearchRequestAdapter(t,this.typesenseClient,this.configuration),e.next=3,r.request();case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"clearCache",value:function(){return this.typesenseClient=new f.SearchClient(this.configuration.server),this.searchClient}},{key:"updateConfiguration",value:function(e){return this.configuration=new d.Configuration(e),this.configuration.validate(),this.typesenseClient=new f.SearchClient(this.configuration.server),!0}},{key:"_validateTypesenseResult",value:function(e){if(e.error)throw new Error("".concat(e.code," - ").concat(e.error));if(!e.hits&&!e.grouped_hits)throw new Error("Did not find any hits. ".concat(e.code," - ").concat(e.error))}}]),e}();t.default=m},705:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.utils=void 0;var n={_adaptHighlightTag:function(e,t,r){return e.replace(new RegExp("<mark>","g"),t||"<mark>").replace(new RegExp("</mark>","g"),r||"</mark>")},_adaptNumberOfPages:function(){var e=this.typesenseResponse.found/this.typesenseResponse.request_params.per_page;return Number.isFinite(e)?Math.ceil(e):1}};t.utils=n},716:function(e,t,r){"use strict";var n=r(568);Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=void 0;var c=n(r(557)),o=n(r(558)),l=function(){function e(){var t,r,n,o,l,h,d,f,y,v,_=this,m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,c.default)(this,e),this.server=m.server||{nodes:[{host:"localhost",port:"8108",path:"",protocol:"http"}]},this.server.cacheSearchResultsForSeconds=null!==(t=this.server.cacheSearchResultsForSeconds)&&void 0!==t?t:120,this.additionalSearchParameters=null!==(r=m.additionalSearchParameters)&&void 0!==r?r:{},this.additionalSearchParameters.query_by=null!==(n=null!==(o=this.additionalSearchParameters.queryBy)&&void 0!==o?o:this.additionalSearchParameters.query_by)&&void 0!==n?n:"",this.additionalSearchParameters.sort_by=null!==(l=null!==(h=this.additionalSearchParameters.sortBy)&&void 0!==h?h:this.additionalSearchParameters.sort_by)&&void 0!==l?l:"",this.additionalSearchParameters.highlight_full_fields=null!==(d=null!==(f=this.additionalSearchParameters.highlightFullFields)&&void 0!==f?f:this.additionalSearchParameters.highlight_full_fields)&&void 0!==d?d:this.additionalSearchParameters.query_by,this.geoLocationField=null!==(y=m.geoLocationField)&&void 0!==y?y:"_geoloc",this.collectionSpecificSearchParameters=null!==(v=m.collectionSpecificSearchParameters)&&void 0!==v?v:{},Object.keys(this.collectionSpecificSearchParameters).forEach((function(e){var t,r,n,c,o,l=_.collectionSpecificSearchParameters[e];l.query_by=null!==(t=l.queryBy)&&void 0!==t?t:l.query_by,l.sort_by=null!==(r=l.sortBy)&&void 0!==r?r:l.sort_by,l.highlight_full_fields=null!==(n=null!==(c=null!==(o=l.highlightFullFields)&&void 0!==o?o:l.highlight_full_fields)&&void 0!==c?c:_.additionalSearchParameters.highlight_full_fields)&&void 0!==n?n:l.query_by,Object.keys(l).forEach((function(e){return void 0===l[e]?delete l[e]:{}}))}))}return(0,o.default)(e,[{key:"validate",value:function(){if((this.additionalSearchParameters.queryBy||Object.values(this.collectionSpecificSearchParameters).some((function(e){return e.queryBy})))&&console.warn("[typesense-instantsearch-adapter] Please use snake_cased versions of parameters in additionalSearchParameters instead of camelCased parameters. For example: Use query_by instead of queryBy. camelCased parameters will be deprecated in a future version. We're making this change so that parameter names are identical to the ones sent to Typesense (which are all snake_cased), and to also keep the types for these parameters in sync with the types defined in typesense-js."),0===this.additionalSearchParameters.query_by.length&&(0===Object.keys(this.collectionSpecificSearchParameters).length||Object.values(this.collectionSpecificSearchParameters).some((function(e){return 0===(e.query_by||"").length}))))throw new Error("[typesense-instantsearch-adapter] Missing parameter: Either additionalSearchParameters.query_by needs to be set, or all collectionSpecificSearchParameters need to have .query_by set")}}]),e}();t.Configuration=l},762:function(e,t,r){"use strict";var n=r(568);Object.defineProperty(t,"__esModule",{value:!0}),t.SearchRequestAdapter=void 0;var c=n(r(636)),o=n(r(321)),l=n(r(638)),h=n(r(557)),d=n(r(558)),f=function(){function e(t,r,n){(0,h.default)(this,e),this.instantsearchRequests=t,this.typesenseClient=r,this.configuration=n,this.additionalSearchParameters=n.additionalSearchParameters,this.collectionSpecificSearchParameters=n.collectionSpecificSearchParameters}var t;return(0,d.default)(e,[{key:"_adaptFacetFilters",value:function(e){var t=this,r="";return e?r=e.map((function(e){if(Array.isArray(e)){var r={};e.forEach((function(e){var n=e.match(t.constructor.FILTER_STRING_MATCHING_REGEX),c="".concat(n[1]).concat(n[2]),o="".concat(n[3]);r[c]=r[c]||[],r[c].push(o)})),Object.keys(r).length>1&&console.error("[Typesense-Instantsearch-Adapter] Typesense does not support cross-field ORs at the moment. The adapter could not OR values between these fields: ".concat(Object.keys(r).join(",")));var n=Object.keys(r)[0],c=r[n].reduce((function(e,r){return r.startsWith("-")&&!t._isNumber(r)?e[0].push(r.substring(1)):e[1].push(r),e}),[[],[]]),o=(0,l.default)(c,2),h=o[0],d=o[1],f=[];return d.length>0&&f.push("".concat(n,":=[").concat(d.map((function(e){return t._escapeFacetValue(e)})).join(","),"]")),h.length>0&&f.push("".concat(n,":!=[").concat(h.map((function(e){return t._escapeFacetValue(e)})).join(","),"]")),f.filter((function(e){return e})).join(" && ")}var y=e.match(t.constructor.FILTER_STRING_MATCHING_REGEX),v="".concat(y[1]).concat(y[2]),_="".concat(y[3]);return _.startsWith("-")&&!t._isNumber(_)?"".concat(v,":!=[").concat(t._escapeFacetValue(_.substring(1)),"]"):"".concat(v,":=[").concat(t._escapeFacetValue(_),"]")})).join(" && "):r}},{key:"_escapeFacetValue",value:function(e){return"boolean"==typeof e||"true"===e||"false"===e||this._isNumber(e)?e:"`".concat(e,"`")}},{key:"_isNumber",value:function(e){return Number.isInteger(e%1)||!!(e%1)}},{key:"_adaptNumericFilters",value:function(e){var t="";if(!e)return t;var r={};e.forEach((function(filter){var e=filter.match(new RegExp("(.*?)(<=|>=|>|<|:|=)(.*)")),t=(0,l.default)(e,4),n=t[1],c=t[2],o=t[3];r[n]=r[n]||{},r[n][c]=o}));var n=[];return Object.keys(r).forEach((function(e){null!=r[e]["<="]&&null!=r[e][">="]?n.push("".concat(e,":=[").concat(r[e][">="],"..").concat(r[e]["<="],"]")):null!=r[e]["<="]?n.push("".concat(e,":<=").concat(r[e]["<="])):null!=r[e][">="]?n.push("".concat(e,":>=").concat(r[e][">="])):null!=r[e]["="]?n.push("".concat(e,":=").concat(r[e]["="])):console.warn("[Typesense-Instantsearch-Adapter] Unsupported operator found ".concat(JSON.stringify(r[e])))})),t=n.join(" && ")}},{key:"_adaptGeoFilter",value:function(e){var t=e.insideBoundingBox,r=e.aroundRadius,n=e.aroundLatLng,c=e.insidePolygon;if(t){var o,h,d,f;if(Array.isArray(t)){var y=t.flat(),v=(0,l.default)(y,4);o=v[0],h=v[1],d=v[2],f=v[3]}else{var _=t.split(","),m=(0,l.default)(_,4);o=m[0],h=m[1],d=m[2],f=m[3]}return"".concat(this.configuration.geoLocationField,":(").concat(o,", ").concat(h,", ").concat(o,", ").concat(f,", ").concat(d,", ").concat(f,", ").concat(d,", ").concat(h,")")}if(n||r){if(!r||"all"===r)throw new Error("[Typesense-Instantsearch-Adapter] In Typesense, geo-filtering around a lat/lng also requires a numerical radius. So the `aroundRadius` parameter is required when `aroundLatLng` is used. If you intend to just geo-sort around a lat/long, you want to use the sortBy InstantSearch widget (or a virtual sortBy custom widget).");var S="".concat(parseFloat(r)/1e3," km");return"".concat(this.configuration.geoLocationField,":(").concat(n,", ").concat(S,")")}if(c){var R=c;return Array.isArray(c)&&(R=c.flat().join(",")),"".concat(this.configuration.geoLocationField,":(").concat(R,")")}}},{key:"_adaptFilters",value:function(e){var t=[];return e.filters&&t.push(e.filters),t.push(this._adaptFacetFilters(e.facetFilters)),t.push(this._adaptNumericFilters(e.numericFilters)),t.push(this._adaptGeoFilter(e)),t.filter((function(filter){return filter&&""!==filter})).join(" && ")}},{key:"_adaptIndexName",value:function(e){return e.match(this.constructor.INDEX_NAME_MATCHING_REGEX)[1]}},{key:"_adaptSortBy",value:function(e){return e.match(this.constructor.INDEX_NAME_MATCHING_REGEX)[3]}},{key:"_buildSearchParameters",value:function(e){for(var t=e.params,r=e.indexName,n=this._adaptIndexName(r),c={},o=0,h=Object.entries(this.additionalSearchParameters);o<h.length;o++){var d=(0,l.default)(h[o],2),f=d[0],y=d[1];c[this._camelToSnakeCase(f)]=y}if(this.collectionSpecificSearchParameters[n])for(var v=0,_=Object.entries(this.collectionSpecificSearchParameters[n]);v<_.length;v++){var m=(0,l.default)(_[v],2),S=m[0],R=m[1];c[this._camelToSnakeCase(S)]=R}var P=Object.assign({},c),k=this._adaptSortBy(r);return Object.assign(P,{collection:n,q:""===t.query||void 0===t.query?"*":t.query,facet_by:[t.facets].flat().join(","),filter_by:this._adaptFilters(t)||c.filter_by,sort_by:k||c.sort_by,max_facet_values:t.maxValuesPerFacet,page:(t.page||0)+1}),t.hitsPerPage&&(P.per_page=t.hitsPerPage),t.facetQuery&&(P.facet_query="".concat(t.facetName,":").concat(t.facetQuery),P.per_page=0),P}},{key:"_camelToSnakeCase",value:function(e){return e.split(/(?=[A-Z])/).join("_").toLowerCase()}},{key:"request",value:(t=(0,o.default)(c.default.mark((function e(){var t,r=this;return c.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.instantsearchRequests.map((function(e){return r._buildSearchParameters(e)})),e.abrupt("return",this.typesenseClient.multiSearch.perform({searches:t}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"INDEX_NAME_MATCHING_REGEX",get:function(){return new RegExp("^(.+?)(?=(/sort/(.*))|$)")}},{key:"FILTER_STRING_MATCHING_REGEX",get:function(){return new RegExp("(.*)((?!:).):(?!:)(.*)")}}]),e}();t.SearchRequestAdapter=f},763:function(e,t,r){"use strict";var n=r(568);Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResponseAdapter=void 0;var c=n(r(638)),o=n(r(646)),l=n(r(623)),h=n(r(557)),d=n(r(558)),f=r(705);function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}var v=function(){function e(t,r,n){(0,h.default)(this,e),this.typesenseResponse=t,this.instantsearchRequest=r,this.configuration=n}return(0,d.default)(e,[{key:"_adaptGroupedHits",value:function(e){var t=this;return e.map((function(e){var r=t._adaptHits(e.hits);return r.forEach((function(t){return t.group_key=e.group_key})),r})).flat()}},{key:"_adaptHits",value:function(e){var t,r=this;return t=e.map((function(e){var t=function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){(0,l.default)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},e.document);t.objectID=e.document.id,t._snippetResult=r._adaptHighlightResult(e,"snippet"),t._highlightResult=r._adaptHighlightResult(e,"value"),["text_match","geo_distance_meters","curated"].forEach((function(r){Object.keys(e).includes(r)&&!Object.keys(t).includes(r)&&(t[r]=e[r])}));var n=t[r.configuration.geoLocationField];return n&&(t._geoloc={lat:n[0],lng:n[1]}),t})),t}},{key:"_adaptHighlightResult",value:function(e,t){var r=this,n=Object.assign.apply(Object,[{}].concat((0,o.default)(Object.entries(e.document).map((function(e){var t=(0,c.default)(e,2),r=t[0],n=t[1];return(0,l.default)({},r,{value:n,matchLevel:"none",matchedWords:[]})})))));return e.highlights.forEach((function(e){n[e.field]={value:e[t]||e["".concat(t,"s")],matchLevel:"full",matchedWords:e.matched_tokens},e.indices&&(n[e.field].matchedIndices=e.indices)})),Object.entries(n).forEach((function(t){var o=(0,c.default)(t,2),l=o[0],h=o[1],d=l,f=h.value,y=h.matchLevel,v=h.matchedWords,_=h.matchedIndices;Array.isArray(f)?(n[d]=[],e.document[d].forEach((function(e,t){_&&_.includes(t)?n[d].push({value:r._adaptHighlightTag("".concat(f[_.indexOf(t)]),r.instantsearchRequest.params.highlightPreTag,r.instantsearchRequest.params.highlightPostTag),matchLevel:y,matchedWords:v[t]}):n[d].push({value:"".concat(e),matchLevel:"none",matchedWords:[]})}))):n[d].value=r._adaptHighlightTag("".concat(f),r.instantsearchRequest.params.highlightPreTag,r.instantsearchRequest.params.highlightPostTag)})),n}},{key:"_adaptFacets",value:function(e){var t={};return e.forEach((function(e){Object.assign(t,(0,l.default)({},e.field_name,Object.assign.apply(Object,[{}].concat((0,o.default)(e.counts.map((function(e){return(0,l.default)({},e.value,e.count)})))))))})),t}},{key:"_adaptFacetStats",value:function(e){var t={};return e.forEach((function(e){Object.keys(e.stats).length>0&&Object.assign(t,(0,l.default)({},e.field_name,e.stats))})),t}},{key:"adapt",value:function(){return{hits:this.typesenseResponse.grouped_hits?this._adaptGroupedHits(this.typesenseResponse.grouped_hits):this._adaptHits(this.typesenseResponse.hits),nbHits:this.typesenseResponse.found,page:this.typesenseResponse.page-1,nbPages:this._adaptNumberOfPages(),hitsPerPage:this.typesenseResponse.request_params.per_page,facets:this._adaptFacets(this.typesenseResponse.facet_counts||[]),facets_stats:this._adaptFacetStats(this.typesenseResponse.facet_counts||{}),query:this.typesenseResponse.request_params.q,processingTimeMS:this.typesenseResponse.search_time_ms}}}]),e}();t.SearchResponseAdapter=v,Object.assign(v.prototype,f.utils)},764:function(e,t,r){"use strict";var n=r(568);Object.defineProperty(t,"__esModule",{value:!0}),t.FacetSearchResponseAdapter=void 0;var c=n(r(557)),o=n(r(558)),l=r(705),h=function(){function e(t,r){(0,c.default)(this,e),this.typesenseResponse=t,this.instantsearchRequest=r}return(0,o.default)(e,[{key:"_adaptFacetHits",value:function(e){var t=this;return e.find((function(e){return e.field_name===t.instantsearchRequest.params.facetName})).counts.map((function(e){return{value:e.value,highlighted:t._adaptHighlightTag(e.highlighted,t.instantsearchRequest.params.highlightPreTag,t.instantsearchRequest.params.highlightPostTag),count:e.count}}))}},{key:"adapt",value:function(){return{facetHits:this._adaptFacetHits(this.typesenseResponse.facet_counts),exhaustiveFacetsCount:!0,processingTimeMS:this.typesenseResponse.search_time_ms}}}]),e}();t.FacetSearchResponseAdapter=h,Object.assign(h.prototype,l.utils)}}]);